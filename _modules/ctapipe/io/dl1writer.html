

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ctapipe.io.dl1writer &mdash; ctapipe v0.1.dev1+gddc003f</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> ctapipe
          

          
          </a>

          
            
            
              <div class="version">
                0.1.dev1+gddc003f
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started For Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development/index.html">Development Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/index.html">Command-Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_models/index.html">Data Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ctapipe_api/index.html">API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bibliography.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Change Log</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ctapipe</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>ctapipe.io.dl1writer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for ctapipe.io.dl1writer</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Class to write DL1 data from an event stream</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">DefaultDict</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tables</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>

<span class="kn">from</span> <span class="nn">..containers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ArrayEventContainer</span><span class="p">,</span>
    <span class="n">SimulatedShowerDistribution</span><span class="p">,</span>
    <span class="n">TelEventIndexContainer</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">..core</span> <span class="kn">import</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Container</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">Provenance</span><span class="p">,</span> <span class="n">ToolConfigurationError</span>
<span class="kn">from</span> <span class="nn">..core.traits</span> <span class="kn">import</span> <span class="n">Bool</span><span class="p">,</span> <span class="n">CaselessStrEnum</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">..io</span> <span class="kn">import</span> <span class="n">EventSource</span><span class="p">,</span> <span class="n">HDF5TableWriter</span><span class="p">,</span> <span class="n">TableWriter</span>
<span class="kn">from</span> <span class="nn">..io.simteleventsource</span> <span class="kn">import</span> <span class="n">SimTelEventSource</span>
<span class="kn">from</span> <span class="nn">..io</span> <span class="kn">import</span> <span class="n">metadata</span> <span class="k">as</span> <span class="n">meta</span>
<span class="kn">from</span> <span class="nn">..instrument</span> <span class="kn">import</span> <span class="n">SubarrayDescription</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DL1Writer&quot;</span><span class="p">,</span> <span class="s2">&quot;DL1_DATA_MODEL_VERSION&quot;</span><span class="p">,</span> <span class="s2">&quot;write_reference_metadata_headers&quot;</span><span class="p">]</span>

<span class="n">tables</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">NODE_CACHE_SLOTS</span> <span class="o">=</span> <span class="mi">3000</span>  <span class="c1"># fixes problem with too many datasets</span>

<span class="n">DL1_DATA_MODEL_VERSION</span> <span class="o">=</span> <span class="s2">&quot;v1.0.2&quot;</span>
<span class="n">PROV</span> <span class="o">=</span> <span class="n">Provenance</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">write_reference_metadata_headers</span><span class="p">(</span><span class="n">obs_id</span><span class="p">,</span> <span class="n">subarray</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attaches Core Provenence headers to an output HDF5 file.</span>
<span class="sd">    Right now this is hard-coded for use with the ctapipe-stage1-process tool</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    output_path: pathlib.Path</span>
<span class="sd">        output HDF5 file</span>
<span class="sd">    obs_id: int</span>
<span class="sd">        observation ID</span>
<span class="sd">    subarray:</span>
<span class="sd">        SubarrayDescription to get metadata from</span>
<span class="sd">    writer: HDF5TableWriter</span>
<span class="sd">        output</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">activity</span> <span class="o">=</span> <span class="n">PROV</span><span class="o">.</span><span class="n">current_activity</span><span class="o">.</span><span class="n">provenance</span>

    <span class="n">reference</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span>
        <span class="n">contact</span><span class="o">=</span><span class="n">meta</span><span class="o">.</span><span class="n">Contact</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">organization</span><span class="o">=</span><span class="s2">&quot;CTA Consortium&quot;</span><span class="p">),</span>
        <span class="n">product</span><span class="o">=</span><span class="n">meta</span><span class="o">.</span><span class="n">Product</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;DL1 Data Product&quot;</span><span class="p">,</span>
            <span class="n">data_category</span><span class="o">=</span><span class="s2">&quot;S&quot;</span><span class="p">,</span>
            <span class="n">data_level</span><span class="o">=</span><span class="s2">&quot;DL1&quot;</span><span class="p">,</span>
            <span class="n">data_association</span><span class="o">=</span><span class="s2">&quot;Subarray&quot;</span><span class="p">,</span>
            <span class="n">data_model_name</span><span class="o">=</span><span class="s2">&quot;ASWG DL1&quot;</span><span class="p">,</span>
            <span class="n">data_model_version</span><span class="o">=</span><span class="n">DL1_DATA_MODEL_VERSION</span><span class="p">,</span>
            <span class="n">data_model_url</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;hdf5&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">process</span><span class="o">=</span><span class="n">meta</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">type_</span><span class="o">=</span><span class="s2">&quot;Simulation&quot;</span><span class="p">,</span> <span class="n">subtype</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">id_</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">obs_id</span><span class="p">)),</span>
        <span class="n">activity</span><span class="o">=</span><span class="n">meta</span><span class="o">.</span><span class="n">Activity</span><span class="o">.</span><span class="n">from_provenance</span><span class="p">(</span><span class="n">activity</span><span class="p">),</span>
        <span class="n">instrument</span><span class="o">=</span><span class="n">meta</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span>
            <span class="n">site</span><span class="o">=</span><span class="s2">&quot;Other&quot;</span><span class="p">,</span>  <span class="c1"># need a way to detect site...</span>
            <span class="n">class_</span><span class="o">=</span><span class="s2">&quot;Subarray&quot;</span><span class="p">,</span>
            <span class="n">type_</span><span class="o">=</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
            <span class="n">id_</span><span class="o">=</span><span class="n">subarray</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># TODO: add activity_stop_time?</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="n">meta</span><span class="o">.</span><span class="n">write_to_hdf5</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">writer</span><span class="o">.</span><span class="n">_h5file</span><span class="p">)</span>


<div class="viewcode-block" id="DL1Writer"><a class="viewcode-back" href="../../../api/ctapipe.io.DL1Writer.html#ctapipe.io.DL1Writer">[docs]</a><span class="k">class</span> <span class="nc">DL1Writer</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialize a sequence of events into a HDF5 DL1 file, in the correct format</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    inside a Tool:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        with DL1Writer(parent=self) as write_dl1:</span>
<span class="sd">            for event in source:</span>
<span class="sd">                calibrate(event)</span>
<span class="sd">                process_images(event)</span>
<span class="sd">                write_dl1(event)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DL1 output filename&quot;</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;events.dl1.h5&quot;</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">write_images</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Store DL1/Event/Image data in output&quot;</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">write_parameters</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Compute and store image parameters&quot;</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">compression_level</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;compression level, 0=None, 9=maximum&quot;</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">9</span>
    <span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">split_datasets_by</span> <span class="o">=</span> <span class="n">CaselessStrEnum</span><span class="p">(</span>
        <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tel_id&quot;</span><span class="p">,</span> <span class="s2">&quot;tel_type&quot;</span><span class="p">],</span>
        <span class="n">default_value</span><span class="o">=</span><span class="s2">&quot;tel_id&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Splitting level for the parameters and images datasets&quot;</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">compression_type</span> <span class="o">=</span> <span class="n">CaselessStrEnum</span><span class="p">(</span>
        <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;blosc:zstd&quot;</span><span class="p">,</span> <span class="s2">&quot;zlib&quot;</span><span class="p">],</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;compressor algorithm to use. &quot;</span><span class="p">,</span>
        <span class="n">default_value</span><span class="o">=</span><span class="s2">&quot;blosc:zstd&quot;</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">write_index_tables</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Generate PyTables index datasets for all tables that contain an &quot;</span>
            <span class="s2">&quot;event_id or tel_id. These speed up in-kernel pytables operations,&quot;</span>
            <span class="s2">&quot;but add some overhead to the file. They can also be generated &quot;</span>
            <span class="s2">&quot;and attached after the file is written &quot;</span>
        <span class="p">),</span>
        <span class="n">default_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">overwrite</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">&quot;overwrite output file if it exists&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_source</span><span class="p">:</span> <span class="n">EventSource</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event_source : EventSource</span>
<span class="sd">            parent event source, which provides header information for the</span>
<span class="sd">            subarray, observation, simulation configuration, and the obs_id</span>
<span class="sd">        config : , optional</span>
<span class="sd">            configuration class</span>
<span class="sd">        parent : , optional</span>
<span class="sd">            parent of this component in the config hierarchy (this supercedes</span>
<span class="sd">            the config option)</span>
<span class="sd">        **kwargs :</span>
<span class="sd">            other options, such as parameters passed to parent.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># here we just set up data, but all real initializtion should be in</span>
        <span class="c1"># setup(), which is called when the first event is read.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_is_simulation</span> <span class="o">=</span> <span class="n">event_source</span><span class="o">.</span><span class="n">is_simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subarray</span><span class="p">:</span> <span class="n">SubarrayDescription</span> <span class="o">=</span> <span class="n">event_source</span><span class="o">.</span><span class="n">subarray</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_simulation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_simulation_config</span> <span class="o">=</span> <span class="n">event_source</span><span class="o">.</span><span class="n">simulation_config</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_simulation_config</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_obs_id</span> <span class="o">=</span> <span class="n">event_source</span><span class="o">.</span><span class="n">obs_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf5_filters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_pointing_tel</span><span class="p">:</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_pointing</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="p">:</span> <span class="n">TableWriter</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>

<div class="viewcode-block" id="DL1Writer.__call__"><a class="viewcode-back" href="../../../api/ctapipe.io.DL1Writer.html#ctapipe.io.DL1Writer.__call__">[docs]</a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">ArrayEventContainer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a single event to the output file. On the first event, the output</span>
<span class="sd">        file is set up</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># perform delayed initialization on first event</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

        <span class="c1"># Write subarray evvent data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_subarray_pointing</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WRITING EVENT </span><span class="si">{event.index}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;dl1/event/subarray/trigger&quot;</span><span class="p">,</span>
            <span class="n">containers</span><span class="o">=</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">trigger</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_simulation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;simulation/event/subarray/shower&quot;</span><span class="p">,</span>
                <span class="n">containers</span><span class="o">=</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">shower</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="c1"># write telescope event data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_telescope_events</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="DL1Writer.setup"><a class="viewcode-back" href="../../../api/ctapipe.io.DL1Writer.html#ctapipe.io.DL1Writer.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;called on first event&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting Up DL1 Output&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_output_path</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subarray</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">)</span>  <span class="c1"># must be first (uses astropy io)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_compression</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_writer</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_simulation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_simulation_configuration</span><span class="p">()</span>

        <span class="c1"># store last pointing to only write unique poitings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_pointing_tel</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span></div>

<div class="viewcode-block" id="DL1Writer.finish"><a class="viewcode-back" href="../../../api/ctapipe.io.DL1Writer.html#ctapipe.io.DL1Writer.finish">[docs]</a>    <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; called after all events are done &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finishing DL1 output&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_index_tables</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_generate_indices</span><span class="p">()</span>
            <span class="n">write_reference_metadata_headers</span><span class="p">(</span>
                <span class="n">subarray</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_subarray</span><span class="p">,</span> <span class="n">obs_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_id</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_writer</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_setup_compression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; setup HDF5 compression&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf5_filters</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">Filters</span><span class="p">(</span>
            <span class="n">complevel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compression_level</span><span class="p">,</span>
            <span class="n">complib</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compression_type</span><span class="p">,</span>
            <span class="n">fletcher32</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># attach a checksum to each chunk for error correction</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;compression filters: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hdf5_filters</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_output_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ensure output path exists, and if requested delete what is there for</span>
<span class="sd">        overwriting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">overwrite</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overwriting </span><span class="si">{self.output_path}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ToolConfigurationError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Output file </span><span class="si">{self.output_path}</span><span class="s2"> exists&quot;</span>
                    <span class="s2">&quot;, use the `overwrite` option or choose another `output_path` &quot;</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;output path: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">)</span>
        <span class="n">PROV</span><span class="o">.</span><span class="n">add_output_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;DL1/Event&quot;</span><span class="p">)</span>

        <span class="c1"># check that options make sense</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_parameters</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_images</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ToolConfigurationError</span><span class="p">(</span>
                <span class="s2">&quot;The options &#39;write_parameters&#39; and &#39;write_images&#39; are &quot;</span>
                <span class="s2">&quot;both set to False. No output will be generated in that case. &quot;</span>
                <span class="s2">&quot;Please enable one or both of these options.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a TableWriter and setup any column exclusions</span>
<span class="sd">        When complete, self._writer should be initialized</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">HDF5TableWriter</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">),</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span>
            <span class="n">add_prefix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">filters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5_filters</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">writer</span><span class="o">.</span><span class="n">add_column_transform</span><span class="p">(</span>
            <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;dl1/event/subarray/trigger&quot;</span><span class="p">,</span>
            <span class="n">col_name</span><span class="o">=</span><span class="s2">&quot;tels_with_trigger&quot;</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_subarray</span><span class="o">.</span><span class="n">tel_ids_to_mask</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># exclude some columns that are not writable</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="s2">&quot;dl1/event/subarray/trigger&quot;</span><span class="p">,</span> <span class="s2">&quot;tel&quot;</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="s2">&quot;dl1/monitoring/subarray/pointing&quot;</span><span class="p">,</span> <span class="s2">&quot;tel&quot;</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="s2">&quot;dl1/monitoring/subarray/pointing&quot;</span><span class="p">,</span> <span class="s2">&quot;event_type&quot;</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="s2">&quot;dl1/monitoring/subarray/pointing&quot;</span><span class="p">,</span> <span class="s2">&quot;tels_with_trigger&quot;</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="s2">&quot;dl1/monitoring/subarray/pointing&quot;</span><span class="p">,</span> <span class="s2">&quot;n_trigger_pixels&quot;</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="s2">&quot;/dl1/event/telescope/trigger&quot;</span><span class="p">,</span> <span class="s2">&quot;trigger_pixels&quot;</span><span class="p">)</span>

        <span class="n">table_names_tel_id</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;tel_</span><span class="si">{tel_id:03d}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">tel_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subarray</span><span class="o">.</span><span class="n">tel</span><span class="p">]</span>
        <span class="n">table_names_tel_type</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">telescope</span><span class="p">)</span> <span class="k">for</span> <span class="n">telescope</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subarray</span><span class="o">.</span><span class="n">telescope_types</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_datasets_by</span> <span class="o">==</span> <span class="s2">&quot;tel_id&quot;</span><span class="p">:</span>
            <span class="n">table_names</span> <span class="o">=</span> <span class="n">table_names_tel_id</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_datasets_by</span> <span class="o">==</span> <span class="s2">&quot;tel_type&quot;</span><span class="p">:</span>
            <span class="n">table_names</span> <span class="o">=</span> <span class="n">table_names_tel_type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table_names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">table_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_parameters</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;/dl1/event/telescope/images/</span><span class="si">{table_name}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;image_mask&quot;</span>
                <span class="p">)</span>

            <span class="n">tel_pointing</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/dl1/monitoring/telescope/pointing/</span><span class="si">{table_name}</span><span class="s2">&quot;</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">tel_pointing</span><span class="p">,</span> <span class="s2">&quot;n_trigger_pixels&quot;</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">tel_pointing</span><span class="p">,</span> <span class="s2">&quot;trigger_pixels&quot;</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/dl1/event/telescope/images/</span><span class="si">{table_name}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_simulation</span><span class="p">:</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;/simulation/event/telescope/images/</span><span class="si">{table_name}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;true_parameters&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># no timing information yet for true images</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;/simulation/event/telescope/parameters/</span><span class="si">{table_name}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">r</span><span class="s2">&quot;peak_time_.*&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;/simulation/event/telescope/parameters/</span><span class="si">{table_name}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;timing_.*&quot;</span>
                <span class="p">)</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="s2">&quot;/simulation/event/subarray/shower&quot;</span><span class="p">,</span> <span class="s2">&quot;true_tel&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">table_names_tel_id</span><span class="p">:</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/dl1/monitoring/event/pointing/</span><span class="si">{table_name}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;event_type&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span> <span class="o">=</span> <span class="n">writer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Writer initialized: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_subarray_pointing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">ArrayEventContainer</span><span class="p">,</span> <span class="n">writer</span><span class="p">:</span> <span class="n">TableWriter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; store subarray pointing info in a monitoring table &quot;&quot;&quot;</span>
        <span class="n">pnt</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">pointing</span>
        <span class="n">current_pointing</span> <span class="o">=</span> <span class="p">(</span><span class="n">pnt</span><span class="o">.</span><span class="n">array_azimuth</span><span class="p">,</span> <span class="n">pnt</span><span class="o">.</span><span class="n">array_altitude</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current_pointing</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_pointing</span><span class="p">:</span>
            <span class="n">pnt</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;dl1/monitoring/subarray/pointing&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span> <span class="n">pnt</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_pointing</span> <span class="o">=</span> <span class="n">current_pointing</span>

    <span class="k">def</span> <span class="nf">_write_simulation_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the simulation headers to a single row of a table. Later</span>
<span class="sd">        if this file is merged with others, that table will grow.</span>

<span class="sd">        Note that this function should be run first</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Writing simulation configuration&quot;</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">ExtraSimInfo</span><span class="p">(</span><span class="n">Container</span><span class="p">):</span>
            <span class="n">container_prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">obs_id</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Simulation Run Identifier&quot;</span><span class="p">)</span>

        <span class="n">extramc</span> <span class="o">=</span> <span class="n">ExtraSimInfo</span><span class="p">()</span>
        <span class="n">extramc</span><span class="o">.</span><span class="n">obs_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_simulation_config</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s2">&quot;configuration/simulation/run&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">extramc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulation_config</span><span class="p">]</span>
        <span class="p">)</span>

<div class="viewcode-block" id="DL1Writer.write_simulation_histograms"><a class="viewcode-back" href="../../../api/ctapipe.io.DL1Writer.html#ctapipe.io.DL1Writer.write_simulation_histograms">[docs]</a>    <span class="k">def</span> <span class="nf">write_simulation_histograms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_source</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the distribution of thrown showers</span>

<span class="sd">        TODO: this needs to be fixed, since it currently requires access to the</span>
<span class="sd">        low-level _file attribute of the SimTelEventSource.  Instead, SimTelEventSource should</span>
<span class="sd">        provide this as header info, like `source.simulation_config`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - this only runs if this is a simulation file. The current implementation is</span>
<span class="sd">          a bit of a hack and implies we should improve SimTelEventSource to read this</span>
<span class="sd">          info.</span>
<span class="sd">        - Currently the histograms are at the end of the simtel file, so if max_events</span>
<span class="sd">          is set to non-zero, the end of the file may not be read, and this no</span>
<span class="sd">          histograms will be found.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_simulation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Not writing simulation histograms for observed data&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event_source</span><span class="p">,</span> <span class="n">SimTelEventSource</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Not writing simulation for non-SimTelEventSource&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Writing simulation histograms&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">fill_from_simtel</span><span class="p">(</span>
            <span class="n">obs_id</span><span class="p">,</span> <span class="n">eventio_hist</span><span class="p">,</span> <span class="n">container</span><span class="p">:</span> <span class="n">SimulatedShowerDistribution</span>
        <span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; fill from a SimTel Histogram entry&quot;&quot;&quot;</span>
            <span class="n">container</span><span class="o">.</span><span class="n">obs_id</span> <span class="o">=</span> <span class="n">obs_id</span>
            <span class="n">container</span><span class="o">.</span><span class="n">hist_id</span> <span class="o">=</span> <span class="n">eventio_hist</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="n">container</span><span class="o">.</span><span class="n">num_entries</span> <span class="o">=</span> <span class="n">eventio_hist</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">]</span>
            <span class="n">xbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                <span class="n">eventio_hist</span><span class="p">[</span><span class="s2">&quot;lower_x&quot;</span><span class="p">],</span>
                <span class="n">eventio_hist</span><span class="p">[</span><span class="s2">&quot;upper_x&quot;</span><span class="p">],</span>
                <span class="n">eventio_hist</span><span class="p">[</span><span class="s2">&quot;n_bins_x&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ybins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                <span class="n">eventio_hist</span><span class="p">[</span><span class="s2">&quot;lower_y&quot;</span><span class="p">],</span>
                <span class="n">eventio_hist</span><span class="p">[</span><span class="s2">&quot;upper_y&quot;</span><span class="p">],</span>
                <span class="n">eventio_hist</span><span class="p">[</span><span class="s2">&quot;n_bins_y&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">container</span><span class="o">.</span><span class="n">bins_core_dist</span> <span class="o">=</span> <span class="n">xbins</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span>
            <span class="n">container</span><span class="o">.</span><span class="n">bins_energy</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">ybins</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span>
            <span class="n">container</span><span class="o">.</span><span class="n">histogram</span> <span class="o">=</span> <span class="n">eventio_hist</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
            <span class="n">container</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;hist_title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eventio_hist</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
            <span class="n">container</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;x_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Log10 E (TeV)&quot;</span>
            <span class="n">container</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;y_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;3D Core Distance (m)&quot;</span>

        <span class="n">hists</span> <span class="o">=</span> <span class="n">event_source</span><span class="o">.</span><span class="n">file_</span><span class="o">.</span><span class="n">histograms</span>
        <span class="k">if</span> <span class="n">hists</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hist_container</span> <span class="o">=</span> <span class="n">SimulatedShowerDistribution</span><span class="p">()</span>
            <span class="n">hist_container</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">hist</span> <span class="ow">in</span> <span class="n">hists</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">hist</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">fill_from_simtel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_id</span><span class="p">,</span> <span class="n">hist</span><span class="p">,</span> <span class="n">hist_container</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;simulation/service/shower_distribution&quot;</span><span class="p">,</span>
                        <span class="n">containers</span><span class="o">=</span><span class="n">hist_container</span><span class="p">,</span>
                    <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_write_telescope_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">:</span> <span class="n">TableWriter</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">ArrayEventContainer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add entries to the event/telescope tables for each telescope in a single</span>
<span class="sd">        event</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># write the telescope tables</span>

        <span class="k">for</span> <span class="n">tel_id</span><span class="p">,</span> <span class="n">dl1_camera</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">dl1</span><span class="o">.</span><span class="n">tel</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dl1_camera</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># don&#39;t want a prefix for this container</span>
            <span class="n">telescope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subarray</span><span class="o">.</span><span class="n">tel</span><span class="p">[</span><span class="n">tel_id</span><span class="p">]</span>
            <span class="n">tel_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">telescope</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;WRITING TELESCOPE </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tel_id</span><span class="p">,</span> <span class="n">telescope</span><span class="p">)</span>

            <span class="n">tel_index</span> <span class="o">=</span> <span class="n">TelEventIndexContainer</span><span class="p">(</span>
                <span class="n">obs_id</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">obs_id</span><span class="p">,</span>
                <span class="n">event_id</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">event_id</span><span class="p">,</span>
                <span class="n">tel_id</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">(</span><span class="n">tel_id</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="n">pnt</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">pointing</span><span class="o">.</span><span class="n">tel</span><span class="p">[</span><span class="n">tel_id</span><span class="p">]</span>
            <span class="n">current_pointing</span> <span class="o">=</span> <span class="p">(</span><span class="n">pnt</span><span class="o">.</span><span class="n">azimuth</span><span class="p">,</span> <span class="n">pnt</span><span class="o">.</span><span class="n">altitude</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current_pointing</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_pointing_tel</span><span class="p">[</span><span class="n">tel_id</span><span class="p">]:</span>
                <span class="n">pnt</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;dl1/monitoring/telescope/pointing/tel_</span><span class="si">{tel_id:03d}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">trigger</span><span class="o">.</span><span class="n">tel</span><span class="p">[</span><span class="n">tel_id</span><span class="p">],</span> <span class="n">pnt</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_last_pointing_tel</span><span class="p">[</span><span class="n">tel_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_pointing</span>

            <span class="n">table_name</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;tel_</span><span class="si">{tel_id:03d}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_datasets_by</span> <span class="o">==</span> <span class="s2">&quot;tel_id&quot;</span> <span class="k">else</span> <span class="n">tel_type</span>
            <span class="p">)</span>

            <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;dl1/event/telescope/trigger&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">tel_index</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">trigger</span><span class="o">.</span><span class="n">tel</span><span class="p">[</span><span class="n">tel_id</span><span class="p">]]</span>
            <span class="p">)</span>

            <span class="n">has_sim_camera</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">tel_id</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">tel</span>
                <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">tel</span><span class="p">[</span><span class="n">tel_id</span><span class="p">]</span><span class="o">.</span><span class="n">true_image</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_parameters</span><span class="p">:</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">table_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;dl1/event/telescope/parameters/</span><span class="si">{table_name}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">containers</span><span class="o">=</span><span class="p">[</span><span class="n">tel_index</span><span class="p">,</span> <span class="o">*</span><span class="n">dl1_camera</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_simulation</span> <span class="ow">and</span> <span class="n">has_sim_camera</span><span class="p">:</span>
                    <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;simulation/event/telescope/parameters/</span><span class="si">{table_name}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="p">[</span>
                            <span class="n">tel_index</span><span class="p">,</span>
                            <span class="o">*</span><span class="n">event</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">tel</span><span class="p">[</span><span class="n">tel_id</span><span class="p">]</span><span class="o">.</span><span class="n">true_parameters</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
                        <span class="p">],</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_images</span><span class="p">:</span>
                <span class="c1"># note that we always write the image, even if the image quality</span>
                <span class="c1"># criteria are not met (those are only to determine if the parameters</span>
                <span class="c1"># can be computed).</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;WRITING IMAGES&quot;</span><span class="p">)</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">table_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;dl1/event/telescope/images/</span><span class="si">{table_name}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">containers</span><span class="o">=</span><span class="p">[</span><span class="n">tel_index</span><span class="p">,</span> <span class="n">dl1_camera</span><span class="p">],</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_simulation</span> <span class="ow">and</span> <span class="n">has_sim_camera</span><span class="p">:</span>
                    <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;simulation/event/telescope/images/</span><span class="si">{table_name}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="p">[</span><span class="n">tel_index</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">tel</span><span class="p">[</span><span class="n">tel_id</span><span class="p">]],</span>
                    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_table_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5file</span><span class="p">,</span> <span class="n">start_node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; helper to generate PyTables index tabnles for common columns &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">h5file</span><span class="o">.</span><span class="n">iter_nodes</span><span class="p">(</span><span class="n">start_node</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">tables</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gen indices for: </span><span class="si">{node}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;event_id&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">colnames</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">event_id</span><span class="o">.</span><span class="n">create_index</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;generated event_id index&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;tel_id&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">colnames</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">tel_id</span><span class="o">.</span><span class="n">create_index</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;generated tel_id index&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;obs_id&quot;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">colnames</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;generated obs_id index&quot;</span><span class="p">)</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">obs_id</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;ultralight&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># recurse</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_generate_table_indices</span><span class="p">(</span><span class="n">h5file</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; generate PyTables index tables for common columns &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Writing index tables&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_images</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_table_indices</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="o">.</span><span class="n">_h5file</span><span class="p">,</span> <span class="s2">&quot;/dl1/event/telescope/images&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_simulation</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_generate_table_indices</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="o">.</span><span class="n">_h5file</span><span class="p">,</span> <span class="s2">&quot;/simulation/event/telescope/images&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_parameters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_table_indices</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="o">.</span><span class="n">_h5file</span><span class="p">,</span> <span class="s2">&quot;/dl1/event/telescope/parameters&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_simulation</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_generate_table_indices</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="o">.</span><span class="n">_h5file</span><span class="p">,</span> <span class="s2">&quot;/simulation/event/telescope/parameters&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_table_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="o">.</span><span class="n">_h5file</span><span class="p">,</span> <span class="s2">&quot;/dl1/event/subarray&quot;</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright ctapipe developers.  Last updated 01 Dec 2020 12:29

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>